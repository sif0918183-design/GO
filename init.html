<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… - ØªØ±Ø­Ø§Ù„</title>
    <style>
        body { font-family: Arial; padding: 20px; text-align: center; }
        .status { margin: 20px; padding: 20px; border-radius: 10px; }
        .loading { background: #fff3cd; color: #856404; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button { padding: 10px 20px; margin: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸš— ØªØ±Ø­Ø§Ù„ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</h1>
    <h2>ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
    
    <div id="status" class="status loading">
        <h3>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©...</h3>
        <div id="steps"></div>
    </div>
    
    <div id="actions" style="display:none;">
        <button onclick="window.location.href='index.html'">Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <button onclick="testSupabase()">Ø§Ø®ØªØ¨Ø§Ø± Supabase</button>
        <button onclick="location.reload()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
    </div>

    <!-- 1. Ù…ÙƒØªØ¨Ø© Supabase Ø£ÙˆÙ„Ø§Ù‹ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- 2. Ù…Ù„Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
    <script src="js/supabase-config.js"></script>
    
    <!-- 3. Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <script>
        // Ø§Ù†ØªØ¸Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ Ø§Ù„ØµÙØ­Ø© Ù…Ø­Ù…Ù„Ø©');
            initializeSystem();
        });
        
        function initializeSystem() {
            const stepsDiv = document.getElementById('steps');
            
            // Ø§Ù„Ø®Ø·ÙˆØ© 1: ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
            stepsDiv.innerHTML += '<p>1. Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª...</p>';
            
            setTimeout(() => {
                if (typeof supabase === 'undefined') {
                    showError('Ù…ÙƒØªØ¨Ø© Supabase ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©');
                    return;
                }
                
                stepsDiv.innerHTML += '<p>âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Supabase</p>';
                
                // Ø§Ù„Ø®Ø·ÙˆØ© 2: ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„
                stepsDiv.innerHTML += '<p>2. Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>';
                
                if (typeof window.supabaseClient === 'undefined') {
                    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                    window.supabaseClient = supabase.createClient(
                        'https://yfumkrfhccwvvfiimhjr.supabase.co',
                        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmdW1rcmZoY2N3dnZmaWltaGpyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4NDYyODEsImV4cCI6MjA4MTQyMjI4MX0.iT6dqwPZhhAb3Y9ZvR_CbHJw9on-CS5OCWoiSC95FOI'
                    );
                }
                
                stepsDiv.innerHTML += '<p>âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Supabase Client</p>';
                
                // Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
                stepsDiv.innerHTML += '<p>3. Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„...</p>';
                
                testConnection();
            }, 1000);
        }
        
        async function testConnection() {
            try {
                const { data, error } = await window.supabaseClient
                    .from('users')
                    .select('count', { count: 'exact', head: true });
                    
                const stepsDiv = document.getElementById('steps');
                
                if (error) {
                    stepsDiv.innerHTML += `<p>âŒ Ø®Ø·Ø£: ${error.message}</p>`;
                    
                    if (error.message.includes('does not exist')) {
                        stepsDiv.innerHTML += `
                            <p>âš ï¸ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©. ÙŠØ±Ø¬Ù‰:</p>
                            <ol>
                                <li>ÙØªØ­ Supabase Dashboard</li>
                                <li>Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ SQL Editor</li>
                                <li>Ù†Ø³Ø® ÙˆÙ„ØµÙ‚ SQL script</li>
                                <li>ØªØ´ØºÙŠÙ„ (Run) Ø§Ù„ÙƒÙˆØ¯</li>
                            </ol>
                        `;
                    }
                    
                    showError('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                } else {
                    stepsDiv.innerHTML += '<p>âœ… Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!</p>';
                    showSuccess('ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­');
                }
            } catch (error) {
                document.getElementById('steps').innerHTML += 
                    `<p>âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ${error.message}</p>`;
                showError('Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹');
            }
        }
        
        function showSuccess(message) {
            const status = document.getElementById('status');
            status.className = 'status success';
            status.innerHTML = `<h3>âœ… ${message}</h3>` + status.innerHTML;
            document.getElementById('actions').style.display = 'block';
        }
        
        function showError(message) {
            const status = document.getElementById('status');
            status.className = 'status error';
            status.innerHTML = `<h3>âŒ ${message}</h3>` + status.innerHTML;
            document.getElementById('actions').style.display = 'block';
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± Supabase ÙŠØ¯ÙˆÙŠØ§Ù‹
        window.testSupabase = function() {
            console.log('Ø§Ø®ØªØ¨Ø§Ø± Supabase ÙŠØ¯ÙˆÙŠØ§Ù‹...');
            console.log('supabase:', typeof supabase);
            console.log('supabaseClient:', window.supabaseClient);
            
            if (window.supabaseClient) {
                window.supabaseClient.from('users').select('count', { count: 'exact', head: true })
                    .then(r => console.log('Ù†ØªÙŠØ¬Ø©:', r))
                    .catch(e => console.log('Ø®Ø·Ø£:', e));
            }
        };
    </script>
</body>
</html>